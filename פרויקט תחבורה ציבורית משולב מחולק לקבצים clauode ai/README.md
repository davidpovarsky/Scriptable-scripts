# KavNav - מערכת מעקב תחבורה ציבורית

מערכת מתקדמת למעקב אחר תחבורה ציבורית בזמן אמת, עם תמיכה מלאה ב-Scriptable ובדפדפן.

## 🎯 תכונות

- **מפה אינטראקטיבית** - הצגת אוטובוסים בזמן אמת
- **תצוגה דואלית** - פאנל תחנות קרובות + מפה
- **גרף מסלולים** - הצגה ויזואלית של התחנות והאוטובוסים
- **זמני הגעה מדויקים** - עדכון אוטומטי כל 10 שניות
- **תמיכה מלאה במובייל** - עיצוב רספונסיבי מושלם

## 📁 מבנה הפרויקט

```
kavnav/
├── config.js                    # הגדרות ראשיות
├── utils.js                     # פונקציות עזר
├── data.js                      # תקשורת עם השרת
├── view.js                      # מחולל HTML
├── main.js                      # orchestrator ראשי
├── kavnav-loader.js            # סקריפט הטעינה
│
├── modules/
│   ├── map/
│   │   ├── mapManager.js       # ניהול המפה
│   │   ├── busMarkers.js       # אייקוני אוטובוס
│   │   └── userLocation.js     # מיקום משתמש
│   │
│   ├── stops/
│   │   └── nearbyPanel.js      # פאנל תחנות קרובות
│   │
│   ├── routes/
│   │   ├── bottomSheet.js      # Bottom sheet ניתן לגרירה
│   │   └── routeCard.js        # כרטיס מסלול בודד
│   │
│   └── ui/
│       ├── modeToggle.js       # מעבר בין מצבים
│       └── utils.js            # פונקציות עזר UI
│
├── styles/
│   ├── base.css               # סגנון בסיסי
│   ├── map.css                # עיצוב מפה
│   ├── stops.css              # עיצוב פאנל תחנות
│   └── routes.css             # עיצוב מסלולים וגרף
│
└── web/
    ├── index.html             # דף HTML ראשי
    ├── style.css              # CSS מאוחד
    └── app.js                 # נקודת כניסה ראשית
```

## 🚀 התקנה והפעלה

### ב-Scriptable (iOS)

1. **צור סקריפט חדש** בשם `KavNav Loader`

2. **העתק את התוכן** מקובץ `kavnav-loader.js`

3. **שנה את ה-REPO_URL** לכתובת הגיטהאב שלך:
   ```javascript
   const REPO_URL = "https://raw.githubusercontent.com/YOUR-USERNAME/YOUR-REPO/main/kavnav/";
   ```

4. **העלה את כל הקבצים** לגיטהאב תחת תיקיית `kavnav/`

5. **הרץ את הסקריפט** - הוא יוריד את כל הקבצים ויריץ את האפליקציה

### בדפדפן (Local Development)

1. **פתח את `web/index.html`** בדפדפן

2. **הרץ שרת מקומי** (אופציונלי, אם יש בעיות CORS):
   ```bash
   # Python 3
   python -m http.server 8000
   
   # Node.js
   npx http-server
   ```

3. **גש ל-`http://localhost:8000/web/index.html`**

## 🔧 התאמה אישית

### שינוי מסלולים ברירת מחדל

ערוך את `config.js`:

```javascript
module.exports.DEFAULT_ROUTES = [
  { routeId: 30794 },  // מספר קו ראשון
  { routeId: 18086 },  // מספר קו שני
];
```

### שינוי צבעי מפעילים

ערוך את `config.js` בקטע `OPERATOR_COLORS`:

```javascript
const OPERATOR_COLORS = {
  "5": "#3868A7",  // דן
  "3": "#218563",  // אגד
  // הוסף עוד...
};
```

### שינוי מרווח רענון

ערוך את `config.js`:

```javascript
module.exports.REFRESH_INTERVAL_MS = 10000; // 10 שניות
```

## 📱 שימוש

### מצבי תצוגה

- **מפה בלבד** - תצוגה מלאה של המפה
- **תצוגה כפולה** - מפה + פאנל תחנות קרובות

### כפתורים

- **📍** - מרכז את המפה על המיקום שלך
- **Toggle** - מעבר בין מצבי תצוגה

### תחנות קרובות

- **לחץ על תחנה** - הצגת זמני הגעה
- **צבעי זמנים**:
  - 🟢 ירוק - עד 5 דקות
  - 🟡 צהוב - 5-10 דקות
  - 🔵 כחול - 10-20 דקות
  - ⚪ אפור - מעל 20 דקות

## 🛠️ פיתוח

### הוספת מודול חדש

1. צור תיקייה חדשה ב-`modules/`
2. צור קובץ JS עם `export class YourClass`
3. ייבא אותו ב-`web/app.js`
4. הוסף לרשימת FILES ב-`kavnav-loader.js`

### הוספת סגנון חדש

1. צור קובץ CSS ב-`styles/`
2. הוסף `@import` ב-`web/style.css`
3. הוסף לרשימת FILES ב-`kavnav-loader.js`

## 🐛 פתרון בעיות

### הסקריפט לא עובד ב-Scriptable

1. בדוק שה-REPO_URL נכון
2. ודא שכל הקבצים הועלו לגיטהאב
3. בדוק את הלוגים ב-Scriptable (Console)

### המפה לא נטענת

1. בדוק חיבור אינטרנט
2. ודא שיש לך הרשאת מיקום
3. נסה לרענן את הדף

### אין נתוני זמן אמת

1. בדוק שיש אוטובוסים פעילים בקווים
2. ודא שהתחנות קיימות במערכת
3. נסה קווים אחרים

## 📄 רישיון

MIT License - ראה LICENSE

## 🤝 תרומה

תרומות מתקבלות בברכה! פתח Issue או Pull Request.

## 📧 יצירת קשר

לשאלות ובעיות, פתח Issue בגיטהאב.

---

**נבנה עם ❤️ בישראל**
